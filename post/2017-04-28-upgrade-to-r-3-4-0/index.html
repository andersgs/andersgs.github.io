<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Anders Gonçalves da Silva">
  <meta name="description" content="Bioinformatician">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="dsci&#39;nomics: data science with a side of genomics">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="dsci&#39;nomics: data science with a side of genomics">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="/post/2017-04-28-upgrade-to-r-3-4-0/">

  

  <title>R upgrading can be a smooth process | dsci&#39;nomics: data science with a side of genomics</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">dsci&#39;nomics: data science with a side of genomics</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  
  <div class="article-header">
    <img src="/img//logos/Rlogo.png" class="article-banner" itemprop="image">
    
  </div>
  

  <div class="article-container">
    <h1 itemprop="name">R upgrading can be a smooth process</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2017-04-28 12:00:00 &#43;0000 UTC" itemprop="datePublished">
      Fri, Apr 28, 2017
    </time>
  </span>

  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2017-04-28-upgrade-to-r-3-4-0%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=R%20upgrading%20can%20be%20a%20smooth%20process&amp;url=%2fpost%2f2017-04-28-upgrade-to-r-3-4-0%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2017-04-28-upgrade-to-r-3-4-0%2f&amp;title=R%20upgrading%20can%20be%20a%20smooth%20process"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2017-04-28-upgrade-to-r-3-4-0%2f&amp;title=R%20upgrading%20can%20be%20a%20smooth%20process"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=R%20upgrading%20can%20be%20a%20smooth%20process&amp;body=%2fpost%2f2017-04-28-upgrade-to-r-3-4-0%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<h1 id="the-problem">The problem</h1>

<p>A new version of <code>R</code> is out &mdash; <a href="https://cran.r-project.org/doc/manuals/r-release/NEWS.html" target="_blank">&ldquo;You Stupid Darkness!&rdquo;</a>.
If you feel a mixture of dread and excitement about upgrading <code>R</code> you
came to the right place. Upgrading <code>R</code> can be exciting, usually because of new features!
In this latest version, I am particularly excited about this one:</p>

<pre><code>The JIT (‘Just In Time’) byte-code compiler is now enabled by default at its level 3. This means functions will be compiled on first or second use and top-level loops will be compiled and then run. (Thanks to Tomas Kalibera for extensive work to make this possible.)
</code></pre>

<p>And, it did not disappoint. <code>R</code> definitely feels snappier!</p>

<p>However, upgrading <code>R</code> can be a pain! Mostly because you may find yourself without any of
your beloved packages installed! If you are like me, however, you may already have
your packages installed in a central location outside the <code>R</code> install folders. The
problem then becomes, how do I update/upgrade all my packages to make sure they
work nicely with the new version of <code>R</code>.</p>

<div class="alert alert-success">
  <p>In this post I will cover:</p>

<ol>
<li><p>How to setup your own static <code>R</code> library folder</p></li>

<li><p>Update to latest <code>R</code> version with all your packages intact</p></li>
</ol>

</div>


<h1 id="some-initial-setup">Some initial setup</h1>

<p>By default, when you install a library, <code>R</code> will install it on the top entry in
your <code>libPaths</code>, a character vector holding the absolute paths to folders in your
system where libraries are stored. When you ask to load a library, <code>R</code> will search
within these folders.</p>

<p>You can see a list of these folders by typing the following in the <code>R</code> console:</p>

<pre><code class="language-r">.libPaths()
</code></pre>

<p>On a Mac, by default, this will return two paths (Linux will give you something
similar):</p>

<pre><code class="language-r">&quot;$HOME/Library/R/&lt;R_version&gt;/library&quot;
&quot;/Library/Frameworks/R.framework/Versions/&lt;R_version&gt;/Resources/library&quot;
</code></pre>

<p>As you can see, the paths depend on the <code>R</code> version! So, these paths will change
every time you upgrade <code>R</code>.</p>

<div class="alert alert-note">
  <p><strong>Our goal is to make sure that the first path on that list is something that
does not change with every update of <code>R</code>!</strong></p>

</div>


<p>Let us start with the case where you don&rsquo;t have your packages yet centrally
filed into a folder outside of the <code>R</code> install folder. In my case, I have a
folder called <code>~/Rlibs</code> where I keep my packages. But it can be called anything
you like. The trick is, once you have created the folder, to make sure it becomes
your default library install folder. To do that, copy paste the following commands
in to the <code>Terminal</code>:</p>

<pre><code class="language-bash">mkdir ~/Rlibs
touch ~/.Renviron
echo &quot;R_LIBS=~/Rlibs&quot; &gt; ~/.Renviron
</code></pre>

<p>The <code>.Renviron</code> file is read by <code>R</code> every time you start <code>R</code>. It reads environmental
variables, in this case <code>R_LIBS</code>.</p>

<p>Now, when you call <code>.libPaths()</code> in the <code>R</code> console, you should see the following:</p>

<pre><code class="language-r">&quot;$HOME/Rlibs&quot;
&quot;$HOME/Library/R/&lt;R_version&gt;/library&quot;
&quot;/Library/Frameworks/R.framework/Versions/&lt;R_version&gt;/Resources/library&quot;
</code></pre>

<h1 id="preparing-for-the-upgrade">Preparing for the upgrade</h1>

<h2 id="if-you-just-setup-your-rlibs-folder">If you just setup your <code>Rlibs</code> folder</h2>

<p>If you just created your <code>Rlibs</code> folder, it will be empty. So, before you upgrade,
you should create a list of packages that are currently installed so you can
install them again, now in your newly minted <code>Rlibs</code> folder, once the upgrade
is complete.</p>

<p>In the <code>R</code> console, type the following:</p>

<pre><code class="language-r">library(magrittr)
library(readr)
installed.packages() %&gt;% 
  as.data.frame() %&gt;% 
  readr::write_csv(&quot;/tmp/installed_packages.csv&quot;)
</code></pre>

<p>What this will do is create a file called <code>/tmp/installed_packages.csv</code>. You can
put it someplace else, if you would like to keep for a posterity. I would just
dump it into <code>/tmp</code> because I don&rsquo;t want to keep for too long. You may also
dump it in <code>$HOME/.Trash</code> if you are on a Mac.</p>

<p>Just to make sure it all worked well, you might want to run the following:</p>

<pre><code class="language-r">readr::read_csv(&quot;/tmp/installed_packages.csv&quot;)
</code></pre>

<p>If it worked, you will get a <code>data.frame</code> with the same results from
<code>installed.packages()</code>.</p>

<h2 id="steps-before-upgrading">Steps before upgrading</h2>

<ol>
<li>If you use <code>RStudio</code>, check that you are running the latest version: <code>Help -&gt; Check for updates</code>.
Install any updates if necessary.</li>
<li>Download the latest <code>R</code> installer for your OS: <a href="https://cloud.r-project.org/" target="_blank">CRAN</a></li>
<li>One final step is probably necessary to avoid immediate crashes after you upgrade. Run the following in <code>Terminal</code>:</li>
</ol>

<pre><code class="language-bash">if [ -f $HOME/.RData ]; then mv $HOME/.RData $HOME/.RData.bk; fi
</code></pre>

<div class="alert alert-warning">
  <p><code>$HOME/.RData</code> can be a source of immediate crashes after an update.</p>

</div>


<p><code>$HOME/.RData</code> when it boots holds any information on
any sessions you may have run with your <code>$HOME</code> as your working directory. When
starting up <code>R</code>, it will usually try to load this file. If you are
like me, these sessions are often just used to test something out quickly, or some
through away code I am trying out from the internet. Now, if that session has any
libraries that have <code>C/C++</code> code compiled with a previous version of <code>R</code>, <code>R</code>
will likely <code>segfault</code> and quit.</p>

<div class="alert alert-info">
  <p>This issue is easier to diagnose if you run the
native <code>R</code> app rather than <code>RStudio</code>. In <code>RStudio</code> you usually only get an unhelpful
message saying that <code>R</code> has quit.</p>

</div>


<p>This is really only a problem because we are trying to be smart, and carry-over
our previous installation of libraries to the new <code>R</code> installation via our
static <code>R</code> library folder. If that did not exist, <code>R</code> would simply fail to load
the library, and issue you with an error saying it could not find the library.
You would then re-install it, and thus you would have avoided this issue altogether.</p>

<h1 id="after-you-upgrade">After you upgrade</h1>

<p>So, you have installed the latest version of <code>RStudio</code> and <code>R</code>. If all went
well so far, you should see something like this in your console when you boot
up <code>RStudio</code>:</p>

<pre><code class="language-r">R version 3.4.0 (2017-04-21) -- &quot;You Stupid Darkness&quot;
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Workspace loaded from ~/.RData]
</code></pre>

<h2 id="before-we-start-installing-upgrading-packages">Before we start installing/upgrading packages</h2>

<h3 id="set-all-the-repositories-you-wish-to-search-for-libraries">Set all the repositories you wish to search for libraries</h3>

<p>The great majority of my packages are available on <code>CRAN</code>. But, a handful
(for instance, the great <a href="https://github.com/GuangchuangYu/ggtree" target="_blank"><code>ggtree</code></a>),
however, are in <code>Bioconductor</code>. You may have other repositories you wish to
have <code>R</code> automatically search for libraries too.</p>

<p>However, by default, <code>R</code> will only search in <code>CRAN</code>. It does have other repositories
listed under <code>$R_HOME/etc/repositories</code>:</p>

<pre><code class="language-bash">## URL          is the base URL (see R-admin.texi)
## default      is whether this should be a default choice
## source, win.binary, mac.binary   indicate if the corresponding type is present
##
## BioC entries are version-specific, with %v getting expanded to the
## BioC version associated with the current R version.
## Also, %bm is substituted from the setting of getOption(&quot;BioC_mirror&quot;)
##
menu_name       URL     default source  win.binary      mac.binary
CRAN    CRAN    @CRAN@  TRUE    TRUE    TRUE    TRUE
BioCsoft        &quot;BioC software&quot; %bm/packages/%v/bioc    FALSE   TRUE    TRUE    TRUE
BioCann &quot;BioC annotation&quot;       %bm/packages/%v/data/annotation FALSE   TRUE    TRUE    TRUE
BioCexp &quot;BioC experiment&quot;       %bm/packages/%v/data/experiment FALSE   TRUE    TRUE    TRUE
BioCextra       &quot;BioC extra&quot;    %bm/packages/%v/extra   FALSE   TRUE    TRUE    TRUE
CRANextra       CRAN (extras)   https://www.stats.ox.ac.uk/pub/RWin     FALSE   TRUE    TRUE    TRUE
Omegahat        Omegahat        http://www.omegahat.net/R       FALSE   TRUE    FALSE   FALSE
R-Forge R-Forge https://R-Forge.R-project.org   FALSE   TRUE    TRUE    TRUE
rforge.net      rforge.net      https://www.rforge.net  FALSE   TRUE    TRUE    TRUE
</code></pre>

<p>Notice that <code>BioConductor</code> is second on the list. So, to enable <code>R</code> to automatically
search <code>CRAN</code> and <code>BioConductor</code> the the following command into the <code>R</code> console:</p>

<pre><code class="language-r">setRepositories(ind = c(1,2))
</code></pre>

<p>I suggest you check the <code>setRepositories</code> documentation if you want to know more.
But, essentially, the <code>ind</code> parameter indicates the indices of the rows of the
<code>$R_HOME/etc/reporsitories</code> file that contain the repositories you wish to
automatically search for libraries. The documentation describes how you can
provide your own list of repositories.</p>

<h3 id="check-that-your-rlibs-is-the-first-in-the-libpaths">Check that your <code>RLibs</code> is the first in the <code>libPaths</code></h3>

<p>Just issue the command <code>libPaths()</code> on the <code>R</code> console. If your <code>$HOME/Rlibs</code>
is not the first on the list, go back up to top of this post, and read about
setting the <code>R_LIBS</code> environmental variable.</p>

<h2 id="if-you-just-setup-your-rlibs-folder-1">If you just setup your <code>RLibs</code> folder</h2>

<p>We will use that file we saved above to generate a list of packages. Take the
following steps:</p>

<ol>
<li>Read in the table:</li>
</ol>

<pre><code class="language-r">package_table &lt;- read.csv(&quot;/tmp/installed_packages.csv&quot;)
</code></pre>

<div class="alert alert-note">
  <p>Note that here I used the <code>utils::read.csv</code> function and not the <code>readr::read_csv</code>
function. The reason is at this point you should not have an
installed copy of <code>readr</code></p>

</div>


<ol>
<li>Pull out the list of package names (the first column of <code>package_table</code>):</li>
</ol>

<pre><code class="language-r">package_names &lt;- package_table[,1]
</code></pre>

<ol>
<li>Install packages automatically:</li>
</ol>

<pre><code class="language-r">install.packages(package_names)
</code></pre>

<p>That is it! Sit back, and watch as <code>R</code> does all the work for you.</p>

<h2 id="if-you-previously-had-an-rlibs-type-folder">If you previously had an <code>RLibs</code>-type folder</h2>

<p>You are in easy territory then. You need to issue
the following command:</p>

<pre><code class="language-r">update.packages(ask = F, checkBuilt = T)
</code></pre>

<p>The <code>ask= F</code> option will refrain from asking you questions. The <code>checkBuilt = T</code>
option is <strong>very important</strong>. It is possible that you have the latest version of
a package but it was built with a previous version of <code>R</code>. In those case, you
want to make sure the package get updated to one that is built with your
current version of <code>R</code>.</p>

<div class="alert alert-note">
  <p>Here, you might want to go get a coffee and/or watch an episode of your
favourite show and/or read some blog posts online. Depending on how many
packages you have installed, it could take a non-trivial amount of time to <br />
finish up.</p>

</div>


<h2 id="one-last-step">One last step&hellip;</h2>

<p>Hopefully, it all went well, and everything has installed/updated, and you
are almost ready to go. Just one last thing. If you moved your <code>$HOME/.RData</code> to
<code>$HOME/.RData.bk</code>. Then shutdown <code>R</code>, and type the following into the <code>Terminal</code>
to get it back:</p>

<pre><code class="language-bash">mv $HOME/.RData.bk $HOME/.RData
</code></pre>

<p>Now, when you boot up <code>R</code> from <code>$HOME</code> you should have your session back, and
hopefully no <code>segfaults</code>!</p>

<h1 id="the-end">The end</h1>

<p>That is it! Congratulations!! You have just upgraded to the latest version of <code>R</code>
in a relatively painless way. Happy coding!</p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    

    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'dscinomics';
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Anders Gonçalves da Silva &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-98372807-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/r.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/bash.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/javascript.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/stan.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

