<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Anders Gonçalves da Silva">
  <meta name="description" content="Data science with a side of genomics!">
  <meta name="keywords" content="Data Science, Genomics, R, Python, Machine Learning">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="dsci&#39;nomics: data science with a side of genomics">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="dsci&#39;nomics: data science with a side of genomics">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="/post/2017-05-07-taste-of-cwl-part1/">

  

  <title>A first taste of the common workflow language, part 1. | dsci&#39;nomics: data science with a side of genomics</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71" 
  data-responsejs='{ 
  "create": [
    { "prop": "width"
    , "prefix": "min-width- r src"
    , "lazy": true
    , "breakpoints": [1281,1025,961,641,481,320,0] }
  ]}'>

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/" 
        data-min-width-0="dsci&#39;nomics"
        data-min-width-481="dsci&#39;nomics: data sci &#43; genomics"
        data-min-width-641="dsci&#39;nomics: data science with a side of genomics">dsci&#39;nomics: data science with a side of genomics</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Talks</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  
  <div class="article-header">
    <img src="/img//logos/CWL_banner.svg" class="article-banner" itemprop="image">
    
  </div>
  

  <div class="article-container">
    <h1 itemprop="name">A first taste of the common workflow language, part 1.</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2017-05-07 12:00:00 &#43;0000 UTC" itemprop="datePublished">
      Sun, May 7, 2017
    </time>
  </span>

  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/cwl">CWL</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2017-05-07-taste-of-cwl-part1%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=A%20first%20taste%20of%20the%20common%20workflow%20language%2c%20part%201.&amp;url=%2fpost%2f2017-05-07-taste-of-cwl-part1%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2017-05-07-taste-of-cwl-part1%2f&amp;title=A%20first%20taste%20of%20the%20common%20workflow%20language%2c%20part%201."
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2017-05-07-taste-of-cwl-part1%2f&amp;title=A%20first%20taste%20of%20the%20common%20workflow%20language%2c%20part%201."
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=A%20first%20taste%20of%20the%20common%20workflow%20language%2c%20part%201.&amp;body=%2fpost%2f2017-05-07-taste-of-cwl-part1%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<h1 id="some-motivation">Some motivation&hellip;</h1>

<p>In a few days, I&rsquo;ll be attending a workshop on the
<a href="(http://www.commonwl.org/)" target="_blank">Common Workflow Language</a>, organised by the
great folks at <a href="http://www.melbournebioinformatics.org.au" target="_blank">Melbourne Bioinformatics</a>,
and to be run by one of CWL&rsquo;s principal developers, Michael Crusoe
(<a href="https://twitter.com/biocrusoe" target="_blank">@biocrusoe</a>). In preparation for the workshop
I thought I would write a series of three posts to outline a bit of my
experience with CWL, and get all my questions for Michael ready!</p>

<h1 id="outline">Outline</h1>

<p>In this first post, I&rsquo;ll give a quick outline of why I got excited about
CWL, and introduce the <code>Command Line Tool Description</code>, the one of two
documents you can write with CWL. In the second post, I&rsquo;ll go over the
<code>Workflow Description</code> document, and then in the third post, I&rsquo;ll
wrap up by giving a quick overview of the tools available to run
CWL flows, and finish with my list of what I really like
about CWL and what I think was not quite as intuitive as I had hoped.</p>

<h1 id="getting-excited-about-cwl">Getting excited about CWL</h1>

<p>If you go to the CWL webpage you are greeted, right at the top, by these two
sentences:</p>

<div class="alert alert-success">
  <p>The Common Workflow Language (CWL) is a specification for describing analysis workflows and tools in a way that makes them portable and scalable across a variety of software and hardware environments, from workstations to cluster, cloud, and high performance computing (HPC) environments. CWL is designed to meet the needs of data-intensive science, such as Bioinformatics, Medical Imaging, Astronomy, Physics, and Chemistry.</p>

</div>


<p>When I first read that a couple of months ago, I found it hard not to get
very excited with these promises. The idea of
writing a single workflow that can be easily scaled up from a single
machine to the cloud, and beyond, is very appealing! <code>And, it supports Docker
containers!</code>. I then decided to try it out
with a real problem that I had at the time: I needed to estimate limit of
detection of <em>in silico</em> MLST for NATA accreditation. At MDU, we use
Torsten Seemann&rsquo;s (<a href="https://thegenomefactory.blogspot.com.au/" target="_blank">The Genome Factory</a>)
<a href="https://github.com/tseemann/mlst" target="_blank">MLST</a> program, which requires an assembly.
My workflow would then consist of taking PE reads as input, sub-sampling
them to a certain depth of coverage, assembling, running MLST, and collating
the data into a single table to be easily imported into <code>R</code>. Simple, right?
Almost, there were a few hitches along the way, but I was still impressed
with CWL.</p>

<div class="alert alert-warning">
  <p>One important thing to remember: CWL is the spec! It is designed to be <code>vendor</code>
agnostic (a <em>lingua franca</em> or trading language for workflows). So, it is
important to distinguish between perceived CWL shortcomings, and
shortcomings of any particular <code>vendor</code> that advertises CWL-support.</p>

</div>


<h1 id="the-cwl-basics">The CWL basics</h1>

<p>Given my experience with <code>make</code> I made the mistake of making comparisons with it,
and had the wrong expectations.</p>

<div class="alert alert-info">
  <p>My advise is, if you have used <code>make</code>, keep an open mind while delving into CWL.
While there are some similarities, implementation differs.</p>

</div>


<p>The general idea of CWL is that you write your workflow as a YAML or JSON
file. These files can then be read and executed by any number of
different software (called <code>vendors</code>). That is what makes CWL portable.
It provides a set of rules of how to write these YAML files that
can be expected to be respected by any piece of software that claims to
support CWL.</p>

<p>There are two kind of documents you can write: <code>Command Line Tool
Description</code>, and a <code>Workflow Description</code>. The <code>Command Line Tool 
Description</code>, as the name implies, describes how to build
command lines, which are the building blocks of for the <code>Workflow
Description</code> documents. In this post, we will look
over <code>Command Line Tool Description</code>.</p>

<h2 id="an-example-command-line-tool-description">An example Command Line Tool Description</h2>

<p>The first step of my limit of detection pipeline was to sub-sample reads
from a pair of FASTQ files. In this post, and the next, I will show you
how I did this in <code>CWL</code> using Heng Li&rsquo;s <code>seqtk</code>.</p>

<p>The <code>Command Line Tool Description</code> is a YAML document that describes how
to build a command line string to run a certain command, and what to do
with the output of the command. To get started, let us have a look a the
description for <code>seqtk sample</code>:</p>

<pre><code class="language-bash">Usage:   seqtk sample [-2] [-s seed=11] &lt;in.fa&gt; &lt;frac&gt;|&lt;number&gt;

Options: -s INT       RNG seed [11]
         -2           2-pass mode: twice as slow but with much reduced memory
</code></pre>

<p>By this description, <code>seqtk sample</code> needs an input sequence file (that while
is implied to be FASTA, it will also accept FASTQ); a fraction or number of
reads to keep (in my case, I used number of reads); and it can optionally
take a <code>seed</code> to set the random number generator, and a flag to indicate
whether to use a <code>2-pass mode</code> or not. I chose not to use the <code>2-pass mode</code>,
so will ignore that option below. However, the <code>seed</code> option was essential
to work with PE reads. By giving the pair of sequences the same seed, I
can guarantee that the same sequenced fragments will be selected from the
two files. What is not explicit in the description is that the output is
streamed to <code>stdout</code>.</p>

<p>So, I am looking to build the equivalent of:</p>

<pre><code class="language-bash">seqtk sample -s 6773 seq_R1.fq 1000 &gt; seq_10000_R1.fq
</code></pre>

<p>Here is how we achieve it using the CLI tool description in CWL (below
I go over each line in detail):</p>

<pre><code class="language-yaml">cwlVersion: v1.0
class: CommandLineTool
doc: &gt;
  A command line tool to use seqtk sample to sub-sample N reads from a single
  FASTQ file. The use of the seed ensures that pairs of reads have the same
  records sampled, and ensure reproducibility of the pipeline by others.
baseCommand: ['seqtk', 'sample']
inputs:
    seed:
        type: int
        inputBinding:
            prefix: -s
            position: 1
        doc: The seed needed to ensure the same records are kept across PE files
    fastq:
        type: File
        inputBinding:
            position: 2
        doc: A single FASTQ input file
    number:
        type: int
        inputBinding:
            position: 3
        doc: An integer specifying how many records to keep
    seqid: 
        type: string
        doc: &gt;
          A string to be used in the output name (notice no inputBinding) to 
          indicate the ID of the sample.
    read_number: 
        type: int
        doc: &gt;
          An int to be used in the output name (notice no inputBinding) that 
          indicates if it is READ1 or READ2 in a pair
    rep: 
        type: int
        doc: &gt;
          An int to be used in the output name (notice no inputBinding) to 
          indicate the replicate sub-sample number
outputs:
    seqtkout:
        type: stdout
stdout: $(inputs.seqid)___$(inputs.number)-$(inputs.seed)-$(inputs.rep)___R$(inputs.read_number).fq
</code></pre>

<p>The first two lines are self-evident. You must specify the version of the
CWL specification that you are using, and that this document specifies a
<code>Command Line Tool</code>. The <code>baseCommand</code> specifies the executable that
should be called, in this case I gave it an array with the main executable
(<code>seqtk</code>), and the sub-command (<code>sample</code>). But, a single string with a
command can be used when appropriate (e.g., <code>baseCommand: mlst</code>).</p>

<p>The <code>doc</code> strings can be used throughout the document to describe what you are
doing and why! I really like this feature, but I suspect it will seldom be
actually used, which is a pity.</p>

<p>Next I have listed the inputs to the tool under <code>inputs</code>.
In <code>inputs</code>, you can list each input the command-line tool requires, and under
each input, you need to specify the <code>type</code>, in this case there are two
examples <code>File</code> and <code>int</code>. Other types include <code>string</code>, <code>array</code>,
<code>Directory</code>, or custom types, which I&rsquo;ll demonstrate in the next post.</p>

<p>For those inputs that will be used to form the command string that will
be run, you must specify the <code>inputBindings</code>. These describe any
<code>prefixes</code> the option should have while building the command string,
the position of each option, if there should be a space between the <code>prefix</code>
and the <code>value</code>, etc.</p>

<p>The <code>outputs</code> section works in a similar way. The name of a particular input
here could be used as an <code>input</code> in another tool downstream. This helps setup
<code>make</code>-like dependencies among tools in a pipeline. One cool thing about <code>CWL</code>
is that it is able to capture <code>stdout</code> of a tool, and push it to a file.</p>

<p>If capturing the tools <code>stdout</code>, you need to specify a filename
under the <code>stdout</code> key. This could be a simple string (e.g., <code>myout.txt</code>),
or it can be an expression, as I have used here. In this case, I used the
<code>$()</code> notation to access elements of the <code>inputs</code> object. The <code>$()</code> gives you
access to a limited set of JavaScript notation to access different objects.
You can use it to access data in <code>inputs</code>, <code>self</code>, and <code>runtime</code> objects.
In this case, I use it to create a filename that has the following pattern:</p>

<pre><code>mySeqId___1000-899666-3___R1.fq
</code></pre>

<p>The values for each parameter are listed under the <code>inputs</code> section!</p>

<div class="alert alert-info">
  <p>CWL lets you use a <code>$()</code> to access parameter values within different
objects. Check out the
<a href="http://www.commonwl.org/v1.0/Workflow.html" target="_blank">documentation</a> for description
of the objects you can access automatically.</p>

</div>


<h1 id="that-is-it-for-now">That is it for now&hellip;</h1>

<p>That is all you really need to know to get started writing your own
<code>Command Line Tool Descriptions</code>. It is fairly simple, and I fount it to be
highly readable. If you want some more examples, check out the
<a href="http://www.commonwl.org/v1.0/UserGuide.html#Wrapping_Command_Line_Tools" target="_blank">Wrapping Command Line Tools</a>
section of the Gentle Introduction to CWL.</p>

<p>As I said before, in part 2 of this post I&rsquo;ll go over the basic
of writing a <code>Workflow Description</code> to produce untold number of
sub-sampled reads that use the above CLI description as a building
block.</p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="/post/2017-04-28-upgrade-to-r-3-4-0/"><span
      aria-hidden="true">&larr;</span> R upgrading can be a smooth process</a></li>
    

    
    <li class="next"><a href="/post/2017-05-10-taste-of-cwl-part2/">A first taste of the common workflow language, part 2. <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'dscinomics';
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Anders Gonçalves da Silva &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js" charset="utf-8"></script>
    <script src="http://airve.github.com/js/response/response.min.js" charset="utf-8"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-98372807-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/r.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/bash.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/javascript.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/stan.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

